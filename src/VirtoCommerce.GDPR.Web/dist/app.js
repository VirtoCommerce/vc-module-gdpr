(()=>{var e;e="virtoCommerce.gdpr",void 0!==AppDependencies&&AppDependencies.push(e),angular.module(e,[]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("workspace.gdpr",{url:"/GDPR",templateUrl:"$(Platform)/Scripts/common/templates/home.tpl.html",controller:["$scope","platformWebApp.bladeNavigationService",function(e,t){t.showBlade({id:"contactList",currentEntity:{id:null},controller:"virtoCommerce.gdpr.contactListController",template:"Modules/$(VirtoCommerce.GDPR)/Scripts/blades/contact-list.tpl.html",isClosingDisabled:!0})}]})}]).run(["platformWebApp.mainMenuService","platformWebApp.widgetService","$state",function(e,t,r){var i={path:"browse/GDPR",icon:"fa fa-cube",title:"GDPR",priority:100,action:function(){r.go("workspace.gdpr")},permission:"GDPR:access"};e.addMenuItem(i)}]),angular.module("virtoCommerce.gdpr").controller("virtoCommerce.gdpr.contactListController",["$scope","virtoCommerce.gdpr.webApi","platformWebApp.dialogService","platformWebApp.bladeUtils","platformWebApp.uiGridHelper","virtoCommerce.customerModule.memberTypesResolverService","platformWebApp.ui-grid.extension",function(e,t,r,i,o,a,n){e.uiGridConstants=o.uiGridConstants;var s=e.blade;s.title="gdpr.blades.contact-list.title";var l=i.bladeNavigationService;function c(e,t){return{id:e,name:t,blade:s,navigate:function(e){e.blade.disableOpenAnimation=!0,l.showBlade(e.blade),e.blade.refresh()}}}s.refresh=function(r){s.isLoading=!0;var i={memberType:s.memberType,memberId:s.currentEntity.id,keyword:d.keyword?d.keyword:void 0,deepSearch:!!d.keyword,sort:o.getSortExpression(e),skip:(e.pageSettings.currentPage-1)*e.pageSettings.itemsPerPageCount,take:e.pageSettings.itemsPerPageCount,objectType:"Member"};s.searchCriteria&&angular.extend(i,s.searchCriteria),t.search(i,(function(t){s.isLoading=!1,e.pageSettings.totalItems=t.totalCount,Array.isArray(t.results)&&t.results.length&&(_.each(t.results,(function(e){e.securityAccounts[0]?(e.email=e.securityAccounts[0].email?e.securityAccounts[0].email:"",e.userName=e.securityAccounts[0].userName?e.securityAccounts[0].userName:""):(e.email="",e.userName="")})),t.results[0].outerId||(t.results[0].outerId=null)),e.listEntries=t.results?t.results:[],function(){if(s.breadcrumbs){var e=s.breadcrumbs.slice(0);if(_.all(e,(function(e){return e.id!==s.currentEntity.id}))){var t=c(s.currentEntity.id,s.currentEntity.name);e.push(t)}s.breadcrumbs=e}else s.breadcrumbs=[c(null,"gdpr.blades.contact-list.breadcrumb-all")]}()})),r&&s.parentRefresh&&s.parentRefresh()},s.showDetailBlade=function(e,t){s.setSelectedNode(e);var i=a.resolve(e.memberType);if(i){var o=angular.copy(i.detailBlade);o.currentEntity=e,o.currentEntityId=e.id,o.isNew=t,l.showBlade(o,s)}else r.showNotificationDialog({id:"error",title:"customer.dialogs.unknown-member-type.title",message:"customer.dialogs.unknown-member-type.message",messageValues:{memberType:e.memberType}})},s.setSelectedNode=function(t){e.selectedNodeId=t.id},e.selectNode=function(e){s.setSelectedNode(e);var t=a.resolve(e.memberType);if(t&&t.knownChildrenTypes&&t.knownChildrenTypes.length){var r={id:s.id,breadcrumbs:s.breadcrumbs,subtitle:"customer.blades.member-list.subtitle",subtitleValues:{name:e.name},currentEntity:e,disableOpenAnimation:!0,controller:s.controller,template:s.template,isClosingDisabled:!0};l.showBlade(r,s.parentBlade)}else s.showDetailBlade(e)},s.headIcon="fa fa-user __customers",s.toolbarCommands=[{name:"platform.commands.refresh",icon:"fa fa-refresh",executeMethod:s.refresh,canExecuteMethod:function(){return!0}}];var d=s.filter={keyword:null};d.criteriaChanged=function(){null===d.keyword&&(s.memberType=void 0),e.pageSettings.currentPage>1?e.pageSettings.currentPage=1:s.refresh()},e.setGridOptions=function(t,r){e.gridOptions=r,n.tryExtendGridOptions(t,r),r.onRegisterApi=function(t){e.gridApi=t,t.core.on.sortChanged(e,(function(){s.isLoading||s.refresh()}))},i.initializePagination(e)}}]),angular.module("virtoCommerce.gdpr").factory("virtoCommerce.gdpr.webApi",["$resource",function(e){return e("api/contacts",{},{getByIds:{method:"GET",url:"api/contacts",isArray:!0},search:{method:"POST",url:"api/contacts/search"},update:{method:"PUT",url:"api/contacts/update"},delete:{method:"DELETE",url:"api/contacts/delete"}})}])})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cGFjazovL1ZpcnRvQ29tbWVyY2UuR0RQUi8uL1NjcmlwdHMvbW9kdWxlLmpzIiwid2VicGFjazovL1ZpcnRvQ29tbWVyY2UuR0RQUi8uL1NjcmlwdHMvYmxhZGVzL2NvbnRhY3QtbGlzdC5qcyIsIndlYnBhY2s6Ly9WaXJ0b0NvbW1lcmNlLkdEUFIvLi9TY3JpcHRzL3Jlc291cmNlcy9nZHByLWFwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDYWxsIHRoaXMgdG8gcmVnaXN0ZXIgeW91ciBtb2R1bGUgdG8gbWFpbiBhcHBsaWNhdGlvblxudmFyIG1vZHVsZU5hbWUgPSAndmlydG9Db21tZXJjZS5nZHByJztcblxuaWYgKEFwcERlcGVuZGVuY2llcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgQXBwRGVwZW5kZW5jaWVzLnB1c2gobW9kdWxlTmFtZSk7XG59XG5cbmFuZ3VsYXIubW9kdWxlKG1vZHVsZU5hbWUsIFtdKVxuICAgIC5jb25maWcoWyckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLFxuICAgICAgICBmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3dvcmtzcGFjZS5nZHByJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvR0RQUicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnJChQbGF0Zm9ybSkvU2NyaXB0cy9jb21tb24vdGVtcGxhdGVzL2hvbWUudHBsLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAnJHNjb3BlJywgJ3BsYXRmb3JtV2ViQXBwLmJsYWRlTmF2aWdhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCBibGFkZU5hdmlnYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0JsYWRlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ2NvbnRhY3RMaXN0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RW50aXR5OiB7IGlkOiBudWxsIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd2aXJ0b0NvbW1lcmNlLmdkcHIuY29udGFjdExpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdNb2R1bGVzLyQoVmlydG9Db21tZXJjZS5HRFBSKS9TY3JpcHRzL2JsYWRlcy9jb250YWN0LWxpc3QudHBsLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0Nsb3NpbmdEaXNhYmxlZDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUobmV3QmxhZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICBdKVxuXG4gICAgLnJ1bihbJ3BsYXRmb3JtV2ViQXBwLm1haW5NZW51U2VydmljZScsICdwbGF0Zm9ybVdlYkFwcC53aWRnZXRTZXJ2aWNlJywgJyRzdGF0ZScsXG4gICAgICAgIGZ1bmN0aW9uIChtYWluTWVudVNlcnZpY2UsIHdpZGdldFNlcnZpY2UsICRzdGF0ZSkge1xuICAgICAgICAgICAgdmFyIG1lbnVJdGVtID0ge1xuICAgICAgICAgICAgICAgIHBhdGg6ICdicm93c2UvR0RQUicsXG4gICAgICAgICAgICAgICAgaWNvbjogJ2ZhIGZhLWN1YmUnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnR0RQUicsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IDEwMCxcbiAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHsgJHN0YXRlLmdvKCd3b3Jrc3BhY2UuZ2RwcicpOyB9LFxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb246ICdHRFBSOmFjY2VzcydcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBtYWluTWVudVNlcnZpY2UuYWRkTWVudUl0ZW0obWVudUl0ZW0pO1xuICAgICAgICB9XG4gICAgXSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKCd2aXJ0b0NvbW1lcmNlLmdkcHInKVxuICAgIC5jb250cm9sbGVyKCd2aXJ0b0NvbW1lcmNlLmdkcHIuY29udGFjdExpc3RDb250cm9sbGVyJywgWyckc2NvcGUnLCAndmlydG9Db21tZXJjZS5nZHByLndlYkFwaScsICdwbGF0Zm9ybVdlYkFwcC5kaWFsb2dTZXJ2aWNlJywgJ3BsYXRmb3JtV2ViQXBwLmJsYWRlVXRpbHMnLCAncGxhdGZvcm1XZWJBcHAudWlHcmlkSGVscGVyJywgJ3ZpcnRvQ29tbWVyY2UuY3VzdG9tZXJNb2R1bGUubWVtYmVyVHlwZXNSZXNvbHZlclNlcnZpY2UnLCAncGxhdGZvcm1XZWJBcHAudWktZ3JpZC5leHRlbnNpb24nLFxuICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCBjb250YWN0cywgZGlhbG9nU2VydmljZSwgYmxhZGVVdGlscywgdWlHcmlkSGVscGVyLCBtZW1iZXJUeXBlc1Jlc29sdmVyU2VydmljZSwgZ3JpZE9wdGlvbkV4dGVuc2lvbikge1xuICAgICAgICAgICAgJHNjb3BlLnVpR3JpZENvbnN0YW50cyA9IHVpR3JpZEhlbHBlci51aUdyaWRDb25zdGFudHM7XG5cbiAgICAgICAgICAgIHZhciBibGFkZSA9ICRzY29wZS5ibGFkZTtcbiAgICAgICAgICAgIGJsYWRlLnRpdGxlID0gJ2dkcHIuYmxhZGVzLmNvbnRhY3QtbGlzdC50aXRsZSc7XG4gICAgICAgICAgICB2YXIgYmxhZGVOYXZpZ2F0aW9uU2VydmljZSA9IGJsYWRlVXRpbHMuYmxhZGVOYXZpZ2F0aW9uU2VydmljZTtcblxuICAgICAgICAgICAgYmxhZGUucmVmcmVzaCA9IGZ1bmN0aW9uIChwYXJlbnRSZWZyZXNoKSB7XG4gICAgICAgICAgICAgICAgYmxhZGUuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoQ3JpdGVyaWEgPSBnZXRTZWFyY2hDcml0ZXJpYSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGJsYWRlLnNlYXJjaENyaXRlcmlhKSB7XG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHNlYXJjaENyaXRlcmlhLCBibGFkZS5zZWFyY2hDcml0ZXJpYSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29udGFjdHMuc2VhcmNoKHNlYXJjaENyaXRlcmlhLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGUuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFnZVNldHRpbmdzLnRvdGFsSXRlbXMgPSBkYXRhLnRvdGFsQ291bnQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEucmVzdWx0cykgJiYgZGF0YS5yZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChkYXRhLnJlc3VsdHMsIGZ1bmN0aW9uICh4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHguc2VjdXJpdHlBY2NvdW50c1swXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeC5lbWFpbCA9IHguc2VjdXJpdHlBY2NvdW50c1swXS5lbWFpbCA/IHguc2VjdXJpdHlBY2NvdW50c1swXS5lbWFpbCA6ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LnVzZXJOYW1lID0geC5zZWN1cml0eUFjY291bnRzWzBdLnVzZXJOYW1lID8geC5zZWN1cml0eUFjY291bnRzWzBdLnVzZXJOYW1lIDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LmVtYWlsID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgudXNlck5hbWUgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEucmVzdWx0c1swXS5vdXRlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0c1swXS5vdXRlcklkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubGlzdEVudHJpZXMgPSBkYXRhLnJlc3VsdHMgPyBkYXRhLnJlc3VsdHMgOiBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0QnJlYWRjcnVtYnMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAocGFyZW50UmVmcmVzaCAmJiBibGFkZS5wYXJlbnRSZWZyZXNoKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsYWRlLnBhcmVudFJlZnJlc2goKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvL0JyZWFkY3J1bWJzXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRCcmVhZGNydW1icygpIHtcbiAgICAgICAgICAgICAgICBpZiAoYmxhZGUuYnJlYWRjcnVtYnMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9DbG9uZSBhcnJheSAoYW5ndWxhci5jb3B5IGxlYXZlcyB0aGUgc2FtZSByZWZlcmVuY2UpXG4gICAgICAgICAgICAgICAgICAgIHZhciBicmVhZGNydW1icyA9IGJsYWRlLmJyZWFkY3J1bWJzLnNsaWNlKDApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vcHJldmVudCBkdXBsaWNhdGUgaXRlbXNcbiAgICAgICAgICAgICAgICAgICAgaWYgKF8uYWxsKGJyZWFkY3J1bWJzLCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZCAhPT0gYmxhZGUuY3VycmVudEVudGl0eS5pZDsgfSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBicmVhZENydW1iID0gZ2VuZXJhdGVCcmVhZGNydW1iKGJsYWRlLmN1cnJlbnRFbnRpdHkuaWQsIGJsYWRlLmN1cnJlbnRFbnRpdHkubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhZGNydW1icy5wdXNoKGJyZWFkQ3J1bWIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJsYWRlLmJyZWFkY3J1bWJzID0gYnJlYWRjcnVtYnM7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYmxhZGUuYnJlYWRjcnVtYnMgPSBbZ2VuZXJhdGVCcmVhZGNydW1iKG51bGwsICdnZHByLmJsYWRlcy5jb250YWN0LWxpc3QuYnJlYWRjcnVtYi1hbGwnKV07XHJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlQnJlYWRjcnVtYihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYmxhZGU6IGJsYWRlLFxuICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZTogZnVuY3Rpb24gKGJyZWFkY3J1bWIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFkY3J1bWIuYmxhZGUuZGlzYWJsZU9wZW5BbmltYXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUoYnJlYWRjcnVtYi5ibGFkZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhZGNydW1iLmJsYWRlLnJlZnJlc2goKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJsYWRlLnNob3dEZXRhaWxCbGFkZSA9IGZ1bmN0aW9uIChsaXN0SXRlbSwgaXNOZXcpIHtcbiAgICAgICAgICAgICAgICBibGFkZS5zZXRTZWxlY3RlZE5vZGUobGlzdEl0ZW0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGZvdW5kVGVtcGxhdGUgPSBtZW1iZXJUeXBlc1Jlc29sdmVyU2VydmljZS5yZXNvbHZlKGxpc3RJdGVtLm1lbWJlclR5cGUpO1xuICAgICAgICAgICAgICAgIGlmIChmb3VuZFRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdCbGFkZSA9IGFuZ3VsYXIuY29weShmb3VuZFRlbXBsYXRlLmRldGFpbEJsYWRlKTtcbiAgICAgICAgICAgICAgICAgICAgbmV3QmxhZGUuY3VycmVudEVudGl0eSA9IGxpc3RJdGVtO1xuICAgICAgICAgICAgICAgICAgICBuZXdCbGFkZS5jdXJyZW50RW50aXR5SWQgPSBsaXN0SXRlbS5pZDtcbiAgICAgICAgICAgICAgICAgICAgbmV3QmxhZGUuaXNOZXcgPSBpc05ldztcbiAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUobmV3QmxhZGUsIGJsYWRlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dTZXJ2aWNlLnNob3dOb3RpZmljYXRpb25EaWFsb2coe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IFwiZXJyb3JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcImN1c3RvbWVyLmRpYWxvZ3MudW5rbm93bi1tZW1iZXItdHlwZS50aXRsZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJjdXN0b21lci5kaWFsb2dzLnVua25vd24tbWVtYmVyLXR5cGUubWVzc2FnZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVZhbHVlczogeyBtZW1iZXJUeXBlOiBsaXN0SXRlbS5tZW1iZXJUeXBlIH0sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qJHNjb3BlLmRlbGV0ZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlTGlzdChbZGF0YV0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlTGlzdChzZWxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgZGlhbG9nID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogXCJjb25maXJtRGVsZXRlSXRlbVwiLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJjdXN0b21lci5kaWFsb2dzLm1lbWJlcnMtZGVsZXRlLnRpdGxlXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiY3VzdG9tZXIuZGlhbG9ncy5tZW1iZXJzLWRlbGV0ZS5tZXNzYWdlXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAocmVtb3ZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVtb3ZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5jbG9zZUNoaWxkcmVuQmxhZGVzKGJsYWRlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZW1iZXJJZHMgPSBfLnBsdWNrKHNlbGVjdGlvbiwgJ2lkJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkc2NvcGUuZ3JpZEFwaSAhPSB1bmRlZmluZWQpICYmICRzY29wZS5ncmlkQXBpLnNlbGVjdGlvbi5nZXRTZWxlY3RBbGxTdGF0ZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VhcmNoQ3JpdGVyaWEgPSBnZXRTZWFyY2hDcml0ZXJpYSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjdHMuZGVsZXRlKHNlYXJjaENyaXRlcmlhLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRBcGkuc2VsZWN0aW9uLmNsZWFyU2VsZWN0ZWRSb3dzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGUucmVmcmVzaCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoXy5hbnkobWVtYmVySWRzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjdHMucmVtb3ZlKHsgaWRzOiBtZW1iZXJJZHMgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7IGJsYWRlLnJlZnJlc2godHJ1ZSk7IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGRpYWxvZ1NlcnZpY2Uuc2hvd0NvbmZpcm1hdGlvbkRpYWxvZyhkaWFsb2cpO1xuICAgICAgICAgICAgfSovXG5cbiAgICAgICAgICAgIGJsYWRlLnNldFNlbGVjdGVkTm9kZSA9IGZ1bmN0aW9uIChsaXN0SXRlbSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZE5vZGVJZCA9IGxpc3RJdGVtLmlkO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdE5vZGUgPSBmdW5jdGlvbiAobGlzdEl0ZW0pIHtcbiAgICAgICAgICAgICAgICBibGFkZS5zZXRTZWxlY3RlZE5vZGUobGlzdEl0ZW0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGZvdW5kVGVtcGxhdGUgPSBtZW1iZXJUeXBlc1Jlc29sdmVyU2VydmljZS5yZXNvbHZlKGxpc3RJdGVtLm1lbWJlclR5cGUpO1xuICAgICAgICAgICAgICAgIGlmIChmb3VuZFRlbXBsYXRlICYmIGZvdW5kVGVtcGxhdGUua25vd25DaGlsZHJlblR5cGVzICYmIGZvdW5kVGVtcGxhdGUua25vd25DaGlsZHJlblR5cGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3QmxhZGUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogYmxhZGUuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhZGNydW1iczogYmxhZGUuYnJlYWRjcnVtYnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJ0aXRsZTogJ2N1c3RvbWVyLmJsYWRlcy5tZW1iZXItbGlzdC5zdWJ0aXRsZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJ0aXRsZVZhbHVlczogeyBuYW1lOiBsaXN0SXRlbS5uYW1lIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RW50aXR5OiBsaXN0SXRlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVPcGVuQW5pbWF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogYmxhZGUuY29udHJvbGxlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBibGFkZS50ZW1wbGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2xvc2luZ0Rpc2FibGVkOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGJsYWRlTmF2aWdhdGlvblNlcnZpY2Uuc2hvd0JsYWRlKG5ld0JsYWRlLCBibGFkZS5wYXJlbnRCbGFkZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYmxhZGUuc2hvd0RldGFpbEJsYWRlKGxpc3RJdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBibGFkZS5oZWFkSWNvbiA9ICdmYSBmYS11c2VyIF9fY3VzdG9tZXJzJztcblxuICAgICAgICAgICAgYmxhZGUudG9vbGJhckNvbW1hbmRzID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJwbGF0Zm9ybS5jb21tYW5kcy5yZWZyZXNoXCIsIGljb246ICdmYSBmYS1yZWZyZXNoJyxcbiAgICAgICAgICAgICAgICAgICAgZXhlY3V0ZU1ldGhvZDogYmxhZGUucmVmcmVzaCxcbiAgICAgICAgICAgICAgICAgICAgY2FuRXhlY3V0ZU1ldGhvZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LyosXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcInBsYXRmb3JtLmNvbW1hbmRzLmFkZFwiLCBpY29uOiAnZmFzIGZhLXBsdXMnLFxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3QmxhZGUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdsaXN0SXRlbUNoaWxkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RW50aXR5OiBibGFkZS5jdXJyZW50RW50aXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnY3VzdG9tZXIuYmxhZGVzLm1lbWJlci1hZGQudGl0bGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnRpdGxlOiAnY3VzdG9tZXIuYmxhZGVzLm1lbWJlci1hZGQuc3VidGl0bGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd2aXJ0b0NvbW1lcmNlLmN1c3RvbWVyTW9kdWxlLm1lbWJlckFkZENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnTW9kdWxlcy8kKFZpcnRvQ29tbWVyY2UuQ3VzdG9tZXIpL1NjcmlwdHMvYmxhZGVzL21lbWJlci1hZGQudHBsLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUobmV3QmxhZGUsIGJsYWRlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2FuRXhlY3V0ZU1ldGhvZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb246ICdjdXN0b21lcjpjcmVhdGUnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwicGxhdGZvcm0uY29tbWFuZHMuZGVsZXRlXCIsIGljb246ICdmYXMgZmEtdHJhc2gtYWx0JyxcbiAgICAgICAgICAgICAgICAgICAgZXhlY3V0ZU1ldGhvZDogZnVuY3Rpb24gKCkgeyBkZWxldGVMaXN0KCRzY29wZS5ncmlkQXBpLnNlbGVjdGlvbi5nZXRTZWxlY3RlZFJvd3MoKSk7IH0sXG4gICAgICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZ3JpZEFwaSAmJiBfLmFueSgkc2NvcGUuZ3JpZEFwaS5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRSb3dzKCkpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uOiAnY3VzdG9tZXI6ZGVsZXRlJ1xuICAgICAgICAgICAgICAgIH0qL1xuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgLy8gc2ltcGxlIGFuZCBhZHZhbmNlZCBmaWx0ZXJpbmdcbiAgICAgICAgICAgIHZhciBmaWx0ZXIgPSBibGFkZS5maWx0ZXIgPSB7IGtleXdvcmQ6IG51bGwgfTtcblxuICAgICAgICAgICAgZmlsdGVyLmNyaXRlcmlhQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyLmtleXdvcmQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgYmxhZGUubWVtYmVyVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wYWdlU2V0dGluZ3MuY3VycmVudFBhZ2UgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wYWdlU2V0dGluZ3MuY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJsYWRlLnJlZnJlc2goKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyB1aS1ncmlkXG4gICAgICAgICAgICAkc2NvcGUuc2V0R3JpZE9wdGlvbnMgPSBmdW5jdGlvbiAoZ3JpZElkLCBncmlkT3B0aW9ucykge1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucyA9IGdyaWRPcHRpb25zO1xuICAgICAgICAgICAgICAgIGdyaWRPcHRpb25FeHRlbnNpb24udHJ5RXh0ZW5kR3JpZE9wdGlvbnMoZ3JpZElkLCBncmlkT3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICBncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgICAgICAgICBncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWJsYWRlLmlzTG9hZGluZykgYmxhZGUucmVmcmVzaCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgYmxhZGVVdGlscy5pbml0aWFsaXplUGFnaW5hdGlvbigkc2NvcGUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2VhcmNoQ3JpdGVyaWEoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlYXJjaENyaXRlcmlhID0ge1xuICAgICAgICAgICAgICAgICAgICBtZW1iZXJUeXBlOiBibGFkZS5tZW1iZXJUeXBlLFxuICAgICAgICAgICAgICAgICAgICBtZW1iZXJJZDogYmxhZGUuY3VycmVudEVudGl0eS5pZCxcbiAgICAgICAgICAgICAgICAgICAga2V5d29yZDogZmlsdGVyLmtleXdvcmQgPyBmaWx0ZXIua2V5d29yZCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgZGVlcFNlYXJjaDogZmlsdGVyLmtleXdvcmQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNvcnQ6IHVpR3JpZEhlbHBlci5nZXRTb3J0RXhwcmVzc2lvbigkc2NvcGUpLFxuICAgICAgICAgICAgICAgICAgICBza2lwOiAoJHNjb3BlLnBhZ2VTZXR0aW5ncy5jdXJyZW50UGFnZSAtIDEpICogJHNjb3BlLnBhZ2VTZXR0aW5ncy5pdGVtc1BlclBhZ2VDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgdGFrZTogJHNjb3BlLnBhZ2VTZXR0aW5ncy5pdGVtc1BlclBhZ2VDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0VHlwZTogJ01lbWJlcidcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWFyY2hDcml0ZXJpYTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9ObyBuZWVkIHRvIGNhbGwgdGhpcyBiZWNhdXNlIHBhZ2UgJ3BhZ2VTZXR0aW5ncy5jdXJyZW50UGFnZScgaXMgd2F0Y2hlZCEhISBJdCB3b3VsZCB0cmlnZ2VyIHN1YnNlcXVlbnQgZHVwbGljYXRlZCByZXEuLi5cbiAgICAgICAgICAgIC8vYmxhZGUucmVmcmVzaCgpO1xuICAgICAgICB9XSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKCd2aXJ0b0NvbW1lcmNlLmdkcHInKVxuICAgIC5mYWN0b3J5KCd2aXJ0b0NvbW1lcmNlLmdkcHIud2ViQXBpJywgWyckcmVzb3VyY2UnLCBmdW5jdGlvbiAoJHJlc291cmNlKSB7XG4gICAgICAgIHJldHVybiAkcmVzb3VyY2UoJ2FwaS9jb250YWN0cycsIHt9LCB7XHJcbiAgICAgICAgICAgIGdldEJ5SWRzOiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiAnYXBpL2NvbnRhY3RzJyxcclxuICAgICAgICAgICAgICAgIGlzQXJyYXk6IHRydWVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2VhcmNoOiB7IG1ldGhvZDogJ1BPU1QnLCB1cmw6ICdhcGkvY29udGFjdHMvc2VhcmNoJyB9LFxyXG4gICAgICAgICAgICB1cGRhdGU6IHsgbWV0aG9kOiAnUFVUJywgdXJsOiAnYXBpL2NvbnRhY3RzL3VwZGF0ZScgfSxcclxuICAgICAgICAgICAgZGVsZXRlOiB7IG1ldGhvZDogJ0RFTEVURScsIHVybDogJ2FwaS9jb250YWN0cy9kZWxldGUnIH1cclxuICAgICAgICB9KTtcbiAgICB9XSk7XHJcbiJdLCJuYW1lcyI6WyJtb2R1bGVOYW1lIiwidW5kZWZpbmVkIiwiQXBwRGVwZW5kZW5jaWVzIiwicHVzaCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiYmxhZGVOYXZpZ2F0aW9uU2VydmljZSIsInNob3dCbGFkZSIsImlkIiwiY3VycmVudEVudGl0eSIsInRlbXBsYXRlIiwiaXNDbG9zaW5nRGlzYWJsZWQiLCJydW4iLCJtYWluTWVudVNlcnZpY2UiLCJ3aWRnZXRTZXJ2aWNlIiwiJHN0YXRlIiwibWVudUl0ZW0iLCJwYXRoIiwiaWNvbiIsInRpdGxlIiwicHJpb3JpdHkiLCJhY3Rpb24iLCJnbyIsInBlcm1pc3Npb24iLCJhZGRNZW51SXRlbSIsImNvbnRhY3RzIiwiZGlhbG9nU2VydmljZSIsImJsYWRlVXRpbHMiLCJ1aUdyaWRIZWxwZXIiLCJtZW1iZXJUeXBlc1Jlc29sdmVyU2VydmljZSIsImdyaWRPcHRpb25FeHRlbnNpb24iLCJ1aUdyaWRDb25zdGFudHMiLCJibGFkZSIsImdlbmVyYXRlQnJlYWRjcnVtYiIsIm5hbWUiLCJuYXZpZ2F0ZSIsImJyZWFkY3J1bWIiLCJkaXNhYmxlT3BlbkFuaW1hdGlvbiIsInJlZnJlc2giLCJwYXJlbnRSZWZyZXNoIiwiaXNMb2FkaW5nIiwic2VhcmNoQ3JpdGVyaWEiLCJtZW1iZXJUeXBlIiwibWVtYmVySWQiLCJrZXl3b3JkIiwiZmlsdGVyIiwiZGVlcFNlYXJjaCIsInNvcnQiLCJnZXRTb3J0RXhwcmVzc2lvbiIsInNraXAiLCJwYWdlU2V0dGluZ3MiLCJjdXJyZW50UGFnZSIsIml0ZW1zUGVyUGFnZUNvdW50IiwidGFrZSIsIm9iamVjdFR5cGUiLCJleHRlbmQiLCJzZWFyY2giLCJkYXRhIiwidG90YWxJdGVtcyIsInRvdGFsQ291bnQiLCJBcnJheSIsImlzQXJyYXkiLCJyZXN1bHRzIiwibGVuZ3RoIiwiXyIsImVhY2giLCJ4Iiwic2VjdXJpdHlBY2NvdW50cyIsImVtYWlsIiwidXNlck5hbWUiLCJvdXRlcklkIiwibGlzdEVudHJpZXMiLCJicmVhZGNydW1icyIsInNsaWNlIiwiYWxsIiwiYnJlYWRDcnVtYiIsInNldEJyZWFkY3J1bWJzIiwic2hvd0RldGFpbEJsYWRlIiwibGlzdEl0ZW0iLCJpc05ldyIsInNldFNlbGVjdGVkTm9kZSIsImZvdW5kVGVtcGxhdGUiLCJyZXNvbHZlIiwibmV3QmxhZGUiLCJjb3B5IiwiZGV0YWlsQmxhZGUiLCJjdXJyZW50RW50aXR5SWQiLCJzaG93Tm90aWZpY2F0aW9uRGlhbG9nIiwibWVzc2FnZSIsIm1lc3NhZ2VWYWx1ZXMiLCJzZWxlY3RlZE5vZGVJZCIsInNlbGVjdE5vZGUiLCJrbm93bkNoaWxkcmVuVHlwZXMiLCJzdWJ0aXRsZSIsInN1YnRpdGxlVmFsdWVzIiwicGFyZW50QmxhZGUiLCJoZWFkSWNvbiIsInRvb2xiYXJDb21tYW5kcyIsImV4ZWN1dGVNZXRob2QiLCJjYW5FeGVjdXRlTWV0aG9kIiwiY3JpdGVyaWFDaGFuZ2VkIiwic2V0R3JpZE9wdGlvbnMiLCJncmlkSWQiLCJncmlkT3B0aW9ucyIsInRyeUV4dGVuZEdyaWRPcHRpb25zIiwib25SZWdpc3RlckFwaSIsImdyaWRBcGkiLCJjb3JlIiwib24iLCJzb3J0Q2hhbmdlZCIsImluaXRpYWxpemVQYWdpbmF0aW9uIiwiZmFjdG9yeSIsIiRyZXNvdXJjZSIsImdldEJ5SWRzIiwibWV0aG9kIiwidXBkYXRlIiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==